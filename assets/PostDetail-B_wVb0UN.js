import{W as S,j as e,X as f,Y as B,r as x,u as p,L as u,U as g,ai as N,aj as v,ak as y,al as C,am as D,an as w,Z as b,_ as P,B as k,g as E,ap as h,D as T,h as H,i as L,k as U,l as F,N as z,ar as $,f as A,z as M,$ as q,a0 as O,as as R,ah as X,ag as K,ao as Q}from"./index-B3204SZ6.js";import{u as W,d as Y,g as Z,D as G,a as J,b as V,c as ee}from"./DialogCreateCommnet-CXOi-yF-.js";import{d as se}from"./actions-sOUqoog4.js";import"./conversation-D3y-OY1v.js";const{ChevronRight:te,Dot:ie,Heart:le,Ellipsis:ge,Trash2:ne,LoaderCircle:re}=M,ae=({postId:s})=>{var m;const n=["comments",s],{data:i,fetchNextPage:r,hasNextPage:l,isFetching:o,isFetchingNextPage:d,status:c}=S({queryKey:n,queryFn:({pageParam:t})=>Z(s,t),initialPageParam:null,getNextPageParam:t=>t==null?void 0:t.nextCursor,staleTime:5e3}),a=i==null?void 0:i.pages.find(t=>t);return c==="pending"?e.jsx(f,{}):c==="success"&&!((m=a==null?void 0:a.comments)!=null&&m.length)&&!l?e.jsx("div",{className:"p-5 flex items-center justify-center",children:e.jsx("span",{className:"text-center",children:"Không có bình luận nào."})}):c==="error"?e.jsx("div",{className:"p-5 flex items-center justify-center",children:e.jsx("span",{className:"text-center text-destructive",children:"Đã xảy ra lỗi khi tải bình luận."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full flex flex-col space-y-5",children:[e.jsxs("div",{className:"flex justify-between items-center p-5 border-b",children:[e.jsx("span",{children:"Thread trả lời"}),e.jsxs("div",{className:"flex items-center gap-1 text-sm opacity-50 cursor-pointer",children:[e.jsx("span",{children:"Xem hoạt động"}),e.jsx(te,{className:"size-5"})]})]}),e.jsxs(B,{onBottomReached:()=>l&&!o&&r(),children:[a==null?void 0:a.comments.map(t=>e.jsx(oe,{data:t},t._id)),d&&e.jsx(re,{className:"mx-auto size-5 animate-spin"})]})]})})},oe=({data:s})=>{const[n,i]=x.useState(!1),{currentData:r}=p(),l=s.likes.includes(r._id),o=W(s.postId);return e.jsxs(e.Fragment,{children:[e.jsx(ce,{open:n,onOpenChange:()=>i(!1),postId:s.postId,commentId:s._id}),e.jsx("div",{className:"w-full flex items-center justify-between p-5 border-b",children:e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("div",{className:"flex flex-col items-center",children:e.jsx(u,{to:`/${s.userId.userName}`,children:e.jsx(g,{avatarUrl:s.userId.avatarUrl})})}),e.jsx("div",{className:"flex-1 w-full space-y-5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsxs("div",{className:"flex w-full items-center",children:[e.jsx(N,{user:s.userId,children:e.jsx(u,{to:`/${s.userId.userName}`,className:"text-sm font-medium hover:underline",children:s.userId.userName})}),e.jsx(ie,{}),e.jsx(v,{delayDuration:300,children:e.jsxs(y,{children:[e.jsx(C,{asChild:!0,children:e.jsx("small",{className:"opacity-50 cursor-default",children:D(s.createdAt)})}),e.jsx(w,{side:"bottom",align:"start",children:b(s.createdAt,"EEEE, d MMMM, yyyy, HH:mm",{locale:P})})]})})]}),s.userId._id===r._id&&e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>i(!0),children:e.jsx(ne,{className:"size-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:s.context}),e.jsxs("div",{className:"flex w-fit gap-1 items-center cursor-pointer rounded-full hover:bg-muted p-2",onClick:()=>o.mutate(s._id),children:[e.jsx(le,{className:E("size-5",l&&"fill-red-500 text-red-500")}),e.jsx("small",{children:h(s.likes.length)})]})]})]})})]})})]})},ce=({open:s,onOpenChange:n,postId:i,commentId:r})=>{const l=Y(i);return e.jsx(T,{open:s,onOpenChange:n,children:e.jsxs(H,{children:[e.jsxs(L,{children:[e.jsx(U,{children:"Xóa bình luận"}),e.jsx(F,{children:"Bạn có chắc muốn xóa bình luận này?"})]}),e.jsxs(z,{children:[e.jsx($,{asChild:!0,children:e.jsx(k,{variant:"outline",children:"Hủy"})}),e.jsx(A,{variant:"destructive",loading:l.isPending,onClick:()=>l.mutate(r,{onSuccess:n(!1)}),children:"Xóa"})]})]})})},{Dot:de,Heart:me,MessageSquare:xe}=M,Ne=()=>{var j;const[s,n]=x.useState(!1),[i,r]=x.useState(!1),[l,o]=x.useState(!1),[d,c]=x.useState(!1),{currentData:a}=p(),{post_id:m}=q(),{data:t,isLoading:_,error:I}=O({queryKey:["detail-post",m],queryFn:()=>se(m),staleTime:5e3});return _?e.jsx(f,{}):I?e.jsx(R,{}):e.jsxs(e.Fragment,{children:[((j=t==null?void 0:t.fileUrls)==null?void 0:j.length)>0&&e.jsx(G,{open:s,onOpenChange:n,attachments:t.fileUrls}),e.jsx(X,{open:i,onOpenChange:r,postId:t._id}),e.jsx(J,{data:a,onOpenChange:o,open:l,postId:t._id}),e.jsx(V,{data:t,onOpenChange:c,open:d}),e.jsxs("div",{className:"max-w-[720px] mx-auto mb-5 border md:rounded-2xl bg-card",children:[e.jsx(ue,{data:t,setShowDeletePost:r,setShowMedia:n,setShowCreateCommnet:o,setShowEditPost:c,currentData:a}),e.jsx(ae,{postId:t._id})]})]})},ue=({data:s,setShowDeletePost:n,setShowMedia:i,setShowCreateCommnet:r,currentData:l,setShowEditPost:o})=>{const d=s.likes.includes(l._id),c=K();return e.jsx("div",{className:"w-full flex items-center justify-between p-5",children:e.jsx("div",{className:"flex flex-col items-center w-full",children:e.jsxs("div",{className:"flex flex-col space-y-3 w-full",children:[e.jsxs("div",{className:"flex justify-between gap-5 w-full",children:[e.jsx(u,{to:`/${s.postedBy.userName}`,children:e.jsx(g,{avatarUrl:s.postedBy.avatarUrl})}),e.jsxs("div",{className:"flex w-full items-center",children:[e.jsx(N,{user:s.postedBy,children:e.jsx(u,{to:`/${s.postedBy.userName}`,className:"text-sm font-medium hover:underline",children:s.postedBy.userName})}),e.jsx(de,{}),e.jsx(v,{delayDuration:300,children:e.jsxs(y,{children:[e.jsx(C,{asChild:!0,children:e.jsx("small",{className:"cursor-default opacity-50",children:D(s.createdAt)})}),e.jsx(w,{side:"bottom",align:"start",children:b(s.createdAt,"EEEE, d MMMM, yyyy, HH:mm",{locale:P})})]})})]}),e.jsx(ee,{postId:s._id,setDeletePost:n,isEdit:s.postedBy._id===l._id,setEditPost:o})]}),e.jsx("span",{className:"text-sm",children:s.context}),e.jsx(Q,{attachments:s.fileUrls,onOpenChange:i}),e.jsxs("div",{className:"flex gap-3 mt-1 border-b",children:[e.jsxs("div",{className:"flex gap-1 items-center cursor-pointer rounded-full hover:bg-muted p-2",onClick:()=>c.mutate(s._id),children:[e.jsx(me,{className:E("size-5",d&&"fill-red-500 text-red-500")}),e.jsx("small",{children:h(s.likes.length)})]}),e.jsxs("div",{className:"flex gap-1 items-center cursor-pointer rounded-full hover:bg-muted p-2",onClick:r,children:[e.jsx(xe,{className:"size-5"}),e.jsx("small",{children:h(s.totalCountComment||0)})]})]})]})})})};export{Ne as default};
