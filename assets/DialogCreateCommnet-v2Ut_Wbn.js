import{at as h,ag as f,j as e,D as C,h as w,i as N,k as b,l as v,au as B,av as L,aw as _,ax as I,aa as J,ab as G,ac as H,ad as p,ae as j,z as q,J as l,p as R,r as y,u as X,ay as O,az as z,aA as E,aB as U,U as F,aC as K,ap as V,N as M,f as D,aD as W,aE as k,aF as P}from"./index-DEM0URhJ.js";const Y=(a,s)=>h({url:f.comments.comment+a,method:"GET",params:s}),Z=(a,s)=>h({url:f.comments.comment+a,method:"POST",data:s}),ee=a=>h({url:f.comments.comment+a,method:"DELETE"}),se=a=>h({url:f.comments.likeUnlike+a,method:"PUT"}),pe=({attachments:a,open:s,onOpenChange:i})=>e.jsx(C,{open:s,onOpenChange:i,children:e.jsxs(w,{onClick:()=>i(!1),className:"max-w-none size-full flex items-center justify-center bg-card/30 backdrop-blur-lg",children:[e.jsxs(N,{children:[e.jsx(b,{}),e.jsx(v,{})]}),e.jsx(B,{opts:{align:"start"},className:"w-full rounded-2xl",children:e.jsx(L,{onClick:i,children:a.map((n,r)=>e.jsx(_,{className:"w-full",children:e.jsx("img",{src:n.url,alt:"Attachment",className:"mx-auto size-full max-w-[500px] object-contain",onClick:t=>t.stopPropagation()})},r))})})]})}),{Ellipsis:te,Bookmark:ae,Link2:ne,SquarePen:re,Trash2:ie,BookmarkCheck:ce}=q,he=({postId:a,setDeletePost:s,isEdit:i,setEditPost:n,isCheckBookMark:r})=>{const t=I(),c=()=>{const o=`${window.location.origin}/${R.POSTS}/${a}`;navigator.clipboard.writeText(o).then(()=>{l.success("Đã sao chép url.")})};return e.jsxs(J,{children:[e.jsx(G,{asChild:!0,children:e.jsx(te,{className:"cursor-pointer size-7 p-1 rounded-full hover:bg-muted"})}),e.jsxs(H,{side:"rigth",align:"start",children:[e.jsxs(p,{className:"flex items-center justify-between gap-5 cursor-pointer",onClick:()=>t.bookmarkPostUser(a),children:[e.jsx("span",{children:r?"Đã lưu":"Lưu"}),r?e.jsx(ce,{className:"size-5"}):e.jsx(ae,{className:"size-5"})]}),e.jsx(j,{}),e.jsxs(p,{className:"flex items-center justify-between gap-5 cursor-pointer",onClick:c,children:[e.jsx("span",{children:"Sao chép liên kết"}),e.jsx(ne,{className:"size-5 -rotate-45"})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx(j,{}),e.jsxs(p,{className:"flex items-center justify-between gap-5 cursor-pointer",onClick:n,children:[e.jsx("span",{children:"Sửa"}),e.jsx(re,{className:"size-5"})]}),e.jsx(j,{}),e.jsxs(p,{className:"flex items-center justify-between gap-5 cursor-pointer text-red-600",onClick:s,children:[e.jsx("span",{children:"Xóa"}),e.jsx(ie,{className:"size-5"})]})]})]})]})},{ImagePlus:oe}=q,fe=({open:a,onOpenChange:s,data:i})=>{const[n,r]=y.useState([]),[t,c]=y.useState(i.fileUrls),{currentData:o}=X(),Q=50*1024*1024,S=O(),x=z({extensions:[E.configure({bold:!1,italic:!1}),U.configure({placeholder:"Có gì mới?"})],content:`<p>${i.context}</p>`}),g=(x==null?void 0:x.getText({blockSeparator:`
`}))||"",T=async u=>{const d=[];for(let m of u){if(m.type.split("/")==="image"&&m.type.split("/")==="video")return l.warning("Định dạng file không hợp lệ. Chỉ nhận file dạng image/video");const $=await W(m);d.push({type:m.type.split("/")[0].toUpperCase(),url:$})}d.length&&c(d)},A=async()=>{if(n.length<=10&&g.trim()){let u=0;for(let m of n)u+=m.size;if(u>Q)return l.warning("Dung lượng file quá lớn (không quá 50mb).");const d={context:g,files:n!=null&&n.length?Array.from(n):[]};S.mutate({postId:i._id,payload:d},{onSuccess:()=>s(!1)})}else l.warning(n.length>10&&"Số lượng file không được vượt quá 10.")};return y.useEffect(()=>{n.length&&T(n)},[n]),e.jsx(C,{open:a,onOpenChange:s,children:e.jsxs(w,{className:"max-sm:size-full md:w-[80vh] max-w-none",children:[e.jsxs(N,{children:[e.jsx(b,{children:"Chỉnh sửa bài viết"}),e.jsx(v,{})]}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx(F,{avatarUrl:o==null?void 0:o.avatarUrl}),e.jsx("div",{className:"flex-1 w-full space-y-5",children:e.jsxs("div",{className:"flex flex-col space-y-5",children:[e.jsx("div",{className:"flex justify-between w-full",children:e.jsx("div",{className:"flex w-full items-center",children:e.jsx("span",{className:"text-sm font-medium cursor-default",children:o==null?void 0:o.userName})})}),e.jsx(K,{editor:x,className:"max-h-[10rem] max-w-[752px] px-5 py-3"}),t.length>0&&e.jsx(V,{attachments:t}),e.jsxs("label",{htmlFor:"attachments",className:"w-fit",children:[e.jsx("input",{type:"file",id:"attachments",multiple:!0,onChange:u=>r(u.target.files),hidden:!0}),e.jsx(oe,{className:"size-5 opacity-50 cursor-pointer"})]})]})})]}),e.jsx(M,{children:e.jsx(D,{disabled:!g.trim(),loading:S.isPending,variant:"outline",onClick:A,children:"Chỉnh sửa"})})]})})},le=async(a,s)=>{try{const i=await Z(a,s);if(i.success)return i}catch(i){console.error(i.message)}},ge=async(a,s)=>{try{const n=await Y(a,{cursor:s});return{comments:n.data,nextCursor:n.nextCursor}}catch(i){console.error(i.message)}},ue=async a=>{try{const s=await ee(a);if(s.success)return s}catch(s){console.error(s.message)}},me=async a=>{try{const s=await se(a);if(s.success)return s.data}catch(s){console.error(s.message)}},de=a=>{const s=k();return P({mutationFn:async r=>await le(a,r),onSuccess:async r=>{const t={queryKey:["comments"],predicate(c){return c.queryKey.includes(a)}};await s.cancelQueries(t),s.setQueriesData(t,c=>{const o=c==null?void 0:c.pages[0];if(o)return{pageParams:c.pageParams,pages:[{comments:[r.data,...o.comments],nextCursor:o.nextCursor},...c.pages.slice(1)]}}),s.invalidateQueries({queryKey:t.queryKey,predicate(c){return t.predicate(c)&&!c.state.data}}),l.success(r.mes)},onError:r=>{console.error(r),l.error(r)}})},je=a=>{const s=k();return P({mutationFn:ue,onSuccess:async n=>{const r={queryKey:["comments"],predicate(t){return t.queryKey.includes(a)}};await s.cancelQueries(r),s.setQueriesData(r,t=>{if(t)return{pageParams:t.pageParams,pages:t.pages.map(c=>({comments:c.comments.filter(o=>o._id!==n.data._id),nextCursor:c.nextCursor}))}}),s.invalidateQueries({queryKey:r.queryKey,predicate(t){return r.predicate(t)&&!t.state.data}}),l.success(n.mes)},onError:n=>{console.error(n),l.error(n)}})},ye=a=>{const s=k();return P({mutationFn:me,onSuccess:async n=>{const r={queryKey:["comments"],predicate(t){return t.queryKey.includes(a)}};await s.cancelQueries(r),s.setQueriesData(r,t=>{if(t)return{pageParams:t.pageParams,pages:t.pages.map(c=>({comments:c.comments.map(o=>o._id===n._id?n:o),nextCursor:c.nextCursor}))}}),s.invalidateQueries({queryKey:r.queryKey,predicate(t){return r.predicate(t)&&!t.state.data}})}})},Ce=({open:a,onOpenChange:s,data:i,postId:n})=>{const r=de(n),t=z({extensions:[E.configure({bold:!1,italic:!1}),U.configure({placeholder:`Trả lời ${i.userName}`})]}),c=(t==null?void 0:t.getText({blockSeparator:`
`}))||"",o=()=>{s(),t.commands.clearContent()};return e.jsx(C,{open:a,onOpenChange:o,children:e.jsxs(w,{className:"max-sm:size-full md:w-[80vh] max-w-none",children:[e.jsxs(N,{children:[e.jsx(b,{children:"Bình luận"}),e.jsx(v,{})]}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx(F,{avatarUrl:i.avatarUrl}),e.jsx("div",{className:"flex-1 w-full space-y-5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex justify-between w-full",children:e.jsx("div",{className:"flex w-full items-center",children:e.jsx("span",{className:"text-sm font-medium cursor-default",children:i.userName})})}),e.jsx(K,{editor:t,className:"max-h-[10rem] max-w-[752px] px-5 py-3"})]})})]}),e.jsx(M,{children:e.jsx(D,{disabled:!c.trim(),loading:r.isPending,variant:"outline",onClick:()=>r.mutate({context:c},{onSuccess:o}),children:"Đăng"})})]})})};export{pe as D,Ce as a,fe as b,he as c,je as d,ge as g,ye as u};
